---
import type { PostgrestSingleResponse } from "@supabase/supabase-js";
import type { Challenge } from "../supa";
import Layout from "../layouts/Layout.astro";
import { getChallenge } from "../supa";

const challenge: PostgrestSingleResponse<Challenge[]> = await getChallenge(
  Astro.request
);

const mostRecentFrom: string | null = challenge.data
  ? challenge.data[0].from
  : null;
const mostRecentTo: string | null = challenge.data
  ? challenge.data[0].to
  : null;
---

<style>
  /* Rm our animations for users who have reduced motion preference setting */
  @media screen and (prefers-reduced-motion: reduce) {
    .animate {
      animation: none !important;
    }
  }

  .animate {
    animation-duration: 0.5s;
    animation-name: animate-fade;
    animation-fill-mode: backwards;
  }

  @keyframes animate-fade {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  .animate.pop {
    animation-name: animate-pop;
    animation-timing-function: cubic-bezier(0.26, 0.53, 0.74, 1.48);
  }

  @keyframes animate-pop {
    0% {
      opacity: 0;
      transform: scale(0.5, 0.5);
    }

    100% {
      opacity: 1;
      transform: scale(1, 1);
    }
  }

  .delay-1 {
    animation-delay: 0.6s;
  }

  .delay-2 {
    animation-delay: 0.7s;
  }

  .delay-3 {
    animation-delay: 0.8s;
  }
</style>

<Layout title="WikiHop App Landing Page">
  <main class="sm:px-4 px-8 text-lg max-w-4xl mx-auto">
    <div class="flex justify-center flex-col items-center mb-20">
      <h1 class="sm:text-8xl text-6xl font-bold text-center mt-8 mb-6">
        WikiHop
      </h1>
      <div class="animate pop flex justify-center flex-col items-center">
        <p class="text-center sm:text-2xl text-xl mb-4 text-neutral-400">
          Some really cool description here. Available on iPhone, iPad, and Mac.
        </p>
        <!-- TODO: replace with real link once published -->
        <a href="https://apps.apple.com/us/">
          <img
            class="w-[180px] drop-shadow-2xl"
            src="/app-store.svg"
            alt="Apple App Store Link"
          />
        </a>
      </div>
    </div>

    <!-- SLAP IN AN IPHONE -->
    {
      mostRecentFrom && mostRecentTo ? (
        <div class="text-center animate pop">
          <h2 class="sm:text-6xl text-4xl font-bold mb-6">Latest Challenge</h2>

          <p id="wiki-para">
            WikiHop from{" "}
            <span id="span-1" class="font-bold">
              {mostRecentFrom}
            </span>
            to{" "}
            <span id="span-2" class="font-bold">
              {mostRecentTo}
            </span>
          </p>
          <svg class="line">
            <line x1="0" y1="0" x2="0" y2="0" />
          </svg>
        </div>
      ) : null
    }
  </main>
</Layout>
